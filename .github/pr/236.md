# cosmic: add env helpers and fix unix.environ() usage

Fixes issue where `unix.environ()` was incorrectly treated as a table instead of an array of "KEY=VALUE" strings.

**Key changes:**
- lib/cosmic/env.lua - shared helper module with get/set/prepend_path/append_path/unset functions
- 3p/nvim-parsers/install.lua - refactored to use cosmic.env helpers, added binary existence checks
- lib/cosmic/test_skill_pr.lua - updated to use env helpers instead of direct array manipulation
- 3p/marksman/test.lua - updated for consistency
- .ast-grep/rules/environ-array-not-table.yml - AST-grep rule to detect misuse patterns
- .claude/CLAUDE.md - documented environment variable handling conventions

**Why this matters:**
`unix.environ()` returns an array like `{"PATH=/usr/bin", "HOME=/root"}`, not a table. Using table-style assignment (`env.PATH = value`) creates table keys rather than modifying the array, causing the changes to be ignored when passed to `spawn()` or `unix.execve()`.

## Validation

- [x] tests pass (test_env, test_skill_pr, test_marksman)
- [x] linter passes
- [x] binary existence checks added for nvim and tree-sitter
- [x] AST-grep rule prevents future misuse
