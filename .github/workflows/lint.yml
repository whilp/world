name: lint

on:
  push:
    branches-ignore:
      - main

jobs:
  # Can't use a matrix here because `uses` doesn't accept expressions.
  # https://github.community/t/expressions-in-docker-uri/16271
  buildifier:
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v2.3.4
      - run: .github/matchers.sh
      - name: lint
        uses: docker://ghcr.io/whilp/buildifier:latest@sha256:c28fbc843117c8ddc87091b6aea1054a754e252643ad6c740f307ce49a272daf
      - run: git add -N . && git diff --exit-code

  gazelle:
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v2.3.4
      - run: .github/matchers.sh
      - name: lint
        uses: docker://ghcr.io/whilp/gazelle:latest@sha256:8b4eb9b593a549284dbd507d92f63b4b480fc7ba321ef357b96120b9074456bb
      - run: git add -N . && git add -N . && git diff --exit-code

  black:
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v2.3.4
      - run: .github/matchers.sh
      - name: lint
        uses: docker://ghcr.io/whilp/black:latest@sha256:660d8a085ee367a707ea796cff3daa6dec24e0e30a6da31e1d15e9efc609a66a
      - run: git add -N . && git diff --exit-code

  bandit:
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v2.3.4
      - run: .github/matchers.sh
      - name: lint
        uses: docker://ghcr.io/whilp/bandit:latest@sha256:965541f21233c961faf951d020c7b7a0f2d35464a88b00c80b73a019c476562c
      - run: git add -N . && git diff --exit-code

  shfmt:
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v2.3.4
      - run: .github/matchers.sh
      - name: lint
        uses: docker://ghcr.io/whilp/shfmt:latest@sha256:dafd366cdc395bd570014516cc1d7b86350489fbd5764689492156025875224c
      - run: git add -N . && git diff --exit-code

  shellcheck:
    runs-on: ubuntu-18.04
    env:
      MANIFEST: .git/ls-files.txt
    steps:
      - uses: actions/checkout@v2.3.4
      - run: .github/matchers.sh
      - name: Prep
        run: git ls-files -z > "${MANIFEST}"
      - name: lint
        uses: docker://ghcr.io/whilp/shellcheck:latest@sha256:a49f960a52b8f99d6ac0a5a5a72cedc4e7b1a367d2af02f4bb294b6f0cb4666e
      - run: git add -N . && git diff --exit-code

  prettier:
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v2.3.4
      - run: .github/matchers.sh
      - name: lint
        uses: docker://ghcr.io/whilp/prettier:latest@sha256:0b273429e4c14d498f4f21ede3236a7f3e30514b863c67d5672417fc46a62ee9
      - run: git add -N . && git diff --exit-code

  eslint:
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v2.3.4
      - run: .github/matchers.sh
      - name: lint
        uses: docker://ghcr.io/whilp/eslint:latest@sha256:e48222b2e26ccd34a5cfd820c735bf09ecd76dab72e7fe3a28adbb6e64f2b65b
      - run: git add -N . && git diff --exit-code

  golangci-lint:
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v2.3.4
      - run: .github/matchers.sh
      - name: clean up
        run: rm -rf cmd/tools
      - name: lint
        uses: docker://ghcr.io/whilp/golangci-lint:latest@sha256:643243af4234933d2c62a61c364534db2f5fbe2175cc26d13d890dbc2baf6321
      - name: restore
        run: git checkout cmd/tools
      - run: git add -N . && git diff --exit-code

  pyright:
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v2.3.4
      - run: .github/matchers.sh
      - name: lint
        uses: docker://ghcr.io/whilp/pyright:latest@sha256:2ab177b9dccac29da1d162ea6683309556e622f132c69f1b3f2eceba2f6c361f
      - run: git add -N . && git diff --exit-code
