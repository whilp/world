#!/usr/bin/env lua
-- luacheck ignore: script runtime

local unix = require("cosmo.unix")
local path = require("cosmo.path")

local environ = require("environ")

local invoked_as = path.basename(arg[0])
local env = environ.new(unix.environ())

local handlers = {
  gh = function(env)
    if not env.USE_GH_HOST then
      env.GH_HOST = nil
    end
  end,
  ghc = function(env)
    env.GH_HOST = "github.com"
  end,
}

local handler = handlers[invoked_as]
if handler then
  handler(env)
end

local home = os.getenv("HOME")
local gh_bin = path.join(home, ".local", "share", "gh", "bin", "gh")
local args = {"gh", table.unpack(arg)}
unix.execve(gh_bin, args, env:toarray())
