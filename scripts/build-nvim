#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
BOOTSTRAP_DIR="${HOME}/.local/bootstrap"

ensure_luajit() {
  if command -v luajit >/dev/null 2>&1; then
    return 0
  fi

  if [ -x "${BOOTSTRAP_DIR}/bin/luajit" ]; then
    export PATH="${BOOTSTRAP_DIR}/bin:${PATH}"
    return 0
  fi

  echo "luajit not found. run setup/luajit to install it first." >&2
  exit 1
}

ensure_luajit
exec luajit "${SCRIPT_DIR}/build-nvim.lua" "$@"
